@using Sicemed.Web.Models
@using Sicemed.Web.Models.Enumerations
@model Sicemed.Web.Models.ViewModels.Profesional.AgendaProfesionalViewModel.TurnoViewModel
@{

    var css = Model.Estado != EstadoTurno.Presentado && Model.Estado != EstadoTurno.Otorgado ? "ui-state-disabled " : string.Empty;
    css += Model.Estado == EstadoTurno.Presentado ? "ui-state-highlight" : string.Empty;

    var cssDuracion = Model.DuracionTurno <= TimeSpan.FromMinutes(10) ? "turno-duracion-corto" : (Model.DuracionTurno <= TimeSpan.FromMinutes(20) ? "turno-duracion-mediano" : "turno-duracion-largo");
}
<h3 class="@css">
    <a href="#" >
        <span class="@cssDuracion">@Model.FechaTurno.ToShortTimeString() / @Model.FechaTurnoFinal.ToShortTimeString()</span>
        | @Model.Paciente.Descripcion
        | @Model.Estado
    </a>    
</h3>
<div>
    <div class="turno turno-@Model.Estado.ToString().ToLower()">
        <div>
            Especialidad: @Model.Especialidad.Descripcion
            <br/>
            <div class="@(Model.Paciente.EsPrimeraVez? "paciente-primera-vez": "paciente-control")">
                @if(Model.Paciente.EsPrimeraVez)
                {
                    @:El paciente es la primera vez que se atiende.    
                }
                else
                {
                    @:El paciente ya se ha atendido con anterioridad.
                    @Html.ActionLink("Historial Atenciones", "Atenciones", "Historial", new { pacienteId = Model.Paciente.Id }, new { target = "_blank" })
                }
            </div>               
            <div>
                N&uacute;mero de Afiliado: @Model.Paciente.NumeroAfiliado<br/>
                @if(!string.IsNullOrWhiteSpace(Model.Paciente.Plan))
                {
                    @:Obra Social: @Model.Paciente.Plan, @Model.Paciente.ObraSocial                    
                }
            </div>
        </div>
        <div>
            @if (Model.Estado == EstadoTurno.Presentado)
            {
                <div>
                    <span>El usuario ingres&oacute; hace @(DateTime.Now.Subtract(Model.FechaIngreso.Value).Minutes)
                              minutos.</span>
                </div> 
            
                using (Html.BeginForm("RegistrarAtencionPaciente", "Profesional"))
                {
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="turnoId" value="@Model.Id"/>
                    <textarea cols="5" rows="10" style="width: 100%;" name="nota"></textarea>
                    @Html.Submit("Atender")
                }
            } 
            @if (Model.PuedoCancelar)
            {
                using (Html.BeginForm("CancelarTurno", "Profesional"))
                {
                    @Html.Partial("_CancelarTurno")
                }
            }                       
        </div>
    </div>
</div>
