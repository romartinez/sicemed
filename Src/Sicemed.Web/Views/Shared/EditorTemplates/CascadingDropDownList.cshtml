@model IEnumerable<SelectListItem>
@{
    var model = Model ?? new SelectListItem[] { };

    var name = ViewData.ModelMetadata.AdditionalValues.ContainsKey("DropDownProperty.PropertyName")
        ? ViewData.ModelMetadata.AdditionalValues["DropDownProperty.PropertyName"].ToString()
        : string.Empty;

    if (!string.IsNullOrWhiteSpace(name))
    {
        ViewData.TemplateInfo.HtmlFieldPrefix = string.Empty;
    }

    var attrs = new Dictionary<string, object>();

    var prompt = !string.IsNullOrWhiteSpace(ViewData.ModelMetadata.Watermark)
        ? ViewData.ModelMetadata.Watermark : "<< Seleccione >>";

    attrs.Add("data-cascading-prompt", prompt);

    if (ViewData.ModelMetadata.AdditionalValues.ContainsKey("CascadingDropDownProperty.ParentPropertyName"))
    {
        attrs.Add("data-cascading-parent", ViewData.ModelMetadata.AdditionalValues["CascadingDropDownProperty.ParentPropertyName"]);
    }

    if (ViewData.ModelMetadata.AdditionalValues.ContainsKey("CascadingDropDownProperty.ActionName"))
    {
        string url;
        if (ViewData.ModelMetadata.AdditionalValues.ContainsKey("CascadingDropDownProperty.ControllerName"))
        {
            url = Url.Action(
                ViewData.ModelMetadata.AdditionalValues["CascadingDropDownProperty.ActionName"].ToString(),
                ViewData.ModelMetadata.AdditionalValues["CascadingDropDownProperty.ControllerName"].ToString());
        }
        else
        {
            url = Url.Action(
                ViewData.ModelMetadata.AdditionalValues["CascadingDropDownProperty.ActionName"].ToString());
        }
        attrs.Add("data-cascading-url", url);
    }

    if (ViewData.ModelMetadata.AdditionalValues.ContainsKey("CascadingDropDownProperty.ParameterName"))
    {
        attrs.Add("data-cascading-parameter", ViewData.ModelMetadata.AdditionalValues["CascadingDropDownProperty.ParameterName"]);
    }

    if (!model.Any())
    {
        attrs.Add("disabled", "disabled");
    }

    attrs.Add("class", "dropdown-cascading");
}
@Html.DropDownList(name, model, prompt, attrs)
<script type="text/javascript" language="javascript">
    $(function () {
        var item = $("#@name");
        var parent = item.data("cascading-parent");
        $("#" + parent).change(function () {
            item.empty();
            item.append($("<option />").text(item.data("cascading-prompt")));

            var val = $(this).val();
            if (!val) return;
            
            var url = item.data("cascading-url");
            var params = {};
            params[item.data("cascading-parameter")] = val;
            $.getJSON(url, params, function (r) {
                if (!r || r.length == 0) {
                    item.addAttr("disabled", "disabled");
                    return;
                } else {
                    item.removeAttr("disabled");
                }
                $.each(r, function () {
                    item.append($("<option />").val(this.Value).text(this.Text));
                });
            });
        });
    });
</script>
